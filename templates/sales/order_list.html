{% extends 'base.html' %}

{% block title %}Pedidos de Venta - SistGoy ERP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Pedidos de Venta</h2>
    <div class="d-flex gap-2">
        <form class="d-flex" method="get">
            <input class="form-control me-2" type="search" name="q" placeholder="Buscar por cliente o ID..."
                aria-label="Buscar" value="{{ request.GET.q }}">
            <button class="btn btn-outline-success" type="submit"><i class="fas fa-search"></i></button>
        </form>
        <a href="{% url 'order-add' %}" class="btn btn-primary"><i class="fas fa-plus me-2"></i> Nuevo Pedido</a>
    </div>
</div>

<div class="card card-glass border-0 shadow-sm">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-light">
                <tr>
                    <th class="ps-4">ID</th>
                    <th>Cliente</th>
                    <th>Estado</th>
                    <th>Total</th>
                    <th>Fecha</th>
                    <th>Dise√±o</th>
                    <th class="pe-4 text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td class="ps-4 fw-bold">#{{ order.id }}</td>
                    <td>{{ order.customer.name }}</td>
                    <td>
                        {% if order.status == 'PENDING' %}
                        <span class="badge bg-warning text-dark">Pendiente</span>
                        {% elif order.status == 'IN_PRESS' %}
                        <span class="badge bg-primary">En Prensa</span>
                        {% elif order.status == 'FINISHED' %}
                        <span class="badge bg-success">Terminado</span>
                        {% elif order.status == 'DELIVERED' %}
                        <span class="badge bg-secondary">Entregado</span>
                        {% endif %}
                    </td>
                    <td>{{ order.total_amount }}</td>
                    <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
                    <td>
                        {% if order.design_url %}
                        <a href="{{ order.design_url }}" target="_blank" class="text-info"><i class="fas fa-link"></i>
                            Ver</a>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td class="pe-4 text-end">
                        <a href="{% url 'order-detail' order.pk %}" class="btn btn-sm btn-outline-info"><i
                                class="fas fa-eye"></i></a>
                        <a href="{% url 'order-edit' order.pk %}" class="btn btn-sm btn-outline-primary"><i
                                class="fas fa-edit"></i></a>
                        <a href="{% url 'order-delete' order.pk %}" class="btn btn-sm btn-outline-danger ms-1"><i
                                class="fas fa-trash"></i></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-4 text-muted">No hay pedidos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}