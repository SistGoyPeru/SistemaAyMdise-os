{% extends 'base.html' %}

{% block title %}Productos Finales - SistGoy ERP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Productos Finales</h2>
    <a href="{% url 'finalproduct-add' %}" class="btn btn-primary"><i class="fas fa-plus me-2"></i> Nuevo Producto</a>
</div>

<div class="card card-glass border-0 shadow-sm">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="thead-logo">
                <tr>
                    <th class="ps-4">Nombre</th>
                    <th>Producto Base</th>
                    <th>Costo Prod.</th>
                    <th>Precio Venta</th>
                    <th>Margen</th>
                    <th>Diseño</th>
                    <th class="pe-4 text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td class="ps-4 fw-bold">
                        <div class="d-flex align-items-center">
                            {% if product.base_product.image %}
                            <img src="{{ product.base_product.image.url }}" class="rounded shadow-sm me-3"
                                style="height: 40px; width: 40px; object-fit: cover;">
                            {% elif "taza" in product.base_product.name.lower or "mug" in
                            product.base_product.name.lower %}
                            <img src="https://www.transparentpng.com/download/mug/white-mug-png-8.png"
                                class="rounded shadow-sm me-3"
                                style="height: 40px; width: 40px; object-fit: contain; background: #f8f9fa;">
                            {% elif "polo" in product.base_product.name.lower or "tshirt" in
                            product.base_product.name.lower or "remera" in product.base_product.name.lower %}
                            <img src="https://www.transparentpng.com/download/t-shirt/white-t-shirt-png-17.png"
                                class="rounded shadow-sm me-3"
                                style="height: 40px; width: 40px; object-fit: contain; background: #f8f9fa;">
                            {% elif "gorra" in product.base_product.name.lower or "cap" in
                            product.base_product.name.lower or "hat" in product.base_product.name.lower %}
                            <img src="https://www.transparentpng.com/download/hat/white-baseball-cap-png-2.png"
                                class="rounded shadow-sm me-3"
                                style="height: 40px; width: 40px; object-fit: contain; background: #f8f9fa;">
                            {% endif %}
                            <a href="{% url 'finalproduct-detail' product.pk %}"
                                class="text-decoration-none text-dark">{{ product.name }}</a>
                        </div>
                    </td>
                    <td>{{ product.base_product.name }}</td>
                    <td>{{ product.calculate_production_cost }}</td>
                    <td>{{ product.sale_price }}</td>
                    <td class="text-success fw-bold">{{ product.calculate_profit_margin }}</td>
                    <td>
                        {% if product.design_file %}
                        <a href="{{ product.design_file.url }}" target="_blank">
                            <img src="{{ product.design_file.url }}" class="rounded shadow-sm"
                                style="height: 50px; width: 50px; object-fit: cover;"
                                onerror="this.src='https://placehold.co/50x50?text=File'">
                        </a>
                        {% else %}
                        <span class="text-muted small">Sin diseño</span>
                        {% endif %}
                    </td>
                    <td class="pe-4 text-end">
                        <a href="{% url 'finalproduct-edit' product.pk %}" class="btn btn-sm btn-outline-primary"><i
                                class="fas fa-edit"></i></a>
                        <a href="{% url 'finalproduct-delete' product.pk %}"
                            class="btn btn-sm btn-outline-danger ms-1"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">No hay productos finales registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}